<div class="create-goal-wrapper">
  <ww-page-title-bar pageTitle="Create Goal"></ww-page-title-bar>
  <ww-page-loader
    loadingText="Just a moment... Goals are on their way."
    *ngIf="isCreateGoalLoading"
  />
  <mat-stepper
    linear
    #stepper
    class="stepper-wrapper"
    *ngIf="!isCreateGoalLoading"
  >
    <mat-step>
      <ng-template matStepLabel>Fill Goal Details</ng-template>
      <form [formGroup]="goalForm" class="goal-form-container">
        <div class="question">
          <label for="goal">What is your goal?</label>
          <mat-form-field appearance="outline">
            <input matInput formControlName="goal" id="goal" />
          </mat-form-field>
        </div>

        <div class="question">
          <label for="importance">Why is this goal important to you?</label>
          <mat-form-field appearance="outline">
            <textarea
              matInput
              formControlName="importance"
              id="importance"
              rows="4"
            ></textarea>
          </mat-form-field>
        </div>

        <div class="question">
          <label>When would you like to achieve this goal?</label>
          <mat-radio-group formControlName="time_frame">
            <mat-radio-button value="1">Within 1 month</mat-radio-button>
            <mat-radio-button value="3">Within 3 months</mat-radio-button>
            <mat-radio-button value="6">Within 6 months</mat-radio-button>
            <mat-radio-button value="12">Within 1 year</mat-radio-button>
          </mat-radio-group>
        </div>

        <div class="question">
          <label for="time_per_week"
            >How much time can you spend in a week? In hours</label
          >
          <mat-form-field appearance="outline">
            <input
              matInput
              type="number"
              formControlName="time_per_week"
              id="time_per_week"
            />
          </mat-form-field>
        </div>
      </form>
      <button
        mat-raised-button
        color="primary"
        [disabled]="isGoalSuggestionLoading"
        (click)="onGetGoalSuggestions()"
      >
        <mat-spinner
          *ngIf="isGoalSuggestionLoading"
          diameter="20"
          strokeWidth="3"
        ></mat-spinner>
        <span *ngIf="!isGoalSuggestionLoading">Next</span>
      </button>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>Choose Tasks for the Goal</ng-template>
      <form [formGroup]="taskForm" class="task-form-container">
        <div class="task-update-message">
          These AI-crafted tasks are meticulously tailored to align with your
          provided goal details, but don't hesitate to shape them further.
          <br />Dive in, fill in any missing details, add new tasks, or bid
          farewell to those no longer needed.
        </div>
        <div formArrayName="tasks">
          <div
            *ngFor="let taskGroup of tasks.controls; let i = index"
            [formGroupName]="i"
            class="task-row"
          >
            <div class="task-heading">
              <span class="heading-label">Task {{ i + 1 }}</span>
              <button mat-icon-button color="warn" (click)="removeTask(i)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            <div class="task-content">
              <div class="field-group">
                <label>Title</label>
                <mat-form-field class="full-width" appearance="outline">
                  <input matInput formControlName="title" placeholder="Title" />
                </mat-form-field>
              </div>
              <div class="field-group">
                <label>Description</label>
                <mat-form-field
                  class="full-width"
                  appearance="outline"
                  rows="3"
                >
                  <textarea
                    matInput
                    formControlName="description"
                    placeholder="Description"
                  ></textarea>
                </mat-form-field>
              </div>
              <div class="flex-container">
                <div class="field-group flex-item">
                  <label>Priority</label>
                  <mat-form-field class="full-width" appearance="outline">
                    <mat-select formControlName="priority">
                      <mat-option
                        *ngFor="let priority of priorities"
                        [value]="priority"
                        >{{ priority }}</mat-option
                      >
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="field-group flex-item">
                  <label>Start Date</label>
                  <mat-form-field class="full-width" appearance="outline">
                    <input
                      matInput
                      [matDatepicker]="startDatePicker"
                      formControlName="startDate"
                      placeholder="Start Date"
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="startDatePicker"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #startDatePicker></mat-datepicker>
                  </mat-form-field>
                </div>
                <div class="field-group flex-item">
                  <label>End Date</label>
                  <mat-form-field class="full-width" appearance="outline">
                    <input
                      matInput
                      [matDatepicker]="endDatePicker"
                      formControlName="endDate"
                      placeholder="End Date"
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="endDatePicker"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #endDatePicker></mat-datepicker>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </div>
        <button
          mat-raised-button
          color="accent"
          type="button"
          (click)="addTask()"
        >
          Add Task
        </button>
        <button mat-raised-button color="primary" (click)="onSave()">
          Next
        </button>
      </form>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>Done</ng-template>
      <div class="confirmation-container">
        <h2>Review Goal Details</h2>
        <h3 class="goal-confirm-message">
          Take a moment to review the details of your new goal before creating
          it.
        </h3>
        <div class="goal-details">
          <div class="goal-section">
            <label>Title: </label>
            <span>{{ goalForm.get("goal")?.value }}</span>
          </div>
          <div class="goal-section">
            <label>Description: </label>
            <span>{{ goalForm.get("importance")?.value }}</span>
          </div>
        </div>
        <div class="task-details">
          <h3 class="goal-confirm-message">Task Details</h3>
          <table class="task-table">
            <thead>
              <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Priority</th>
                <th>Start Date</th>
                <th>End Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let task of tasks.controls">
                <td>{{ task.get("title")?.value }}</td>
                <td>{{ task.get("description")?.value }}</td>
                <td>{{ task.get("priority")?.value }}</td>
                <td>{{ task.get("startDate")?.value | date }}</td>
                <td>{{ task.get("endDate")?.value | date }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div>
        <button mat-raised-button matStepperPrevious color="accent">
          Back
        </button>
        <button mat-raised-button color="primary" (click)="createGoal()">
          Create Goal
        </button>
      </div>
    </mat-step>
  </mat-stepper>
</div>
